# 2021年5月11日

今日は仕事が全くはかどりませんでした。

## rust

インストールした。特になにか書いたわけではない。

## YubiKey

YubiKeyなどのセキュリティキーに搭載されているFIDO2の機能で作成したSSH鍵をGitHubで使えるようになったというので試そうとした。[yubicoの紹介ページ](https://www.yubico.com/blog/github-now-supports-ssh-security-keys/)

なぜこれができると嬉しいかと言うとセキュリティキーにはある程度の耐タンパー性能があり簡単にはデータを取り出せないようになっていて、どちらか片方だけにアクセスしても機能はさせられないなので常に持っていることでセキュリティを向上させることができる。あとはマシン・OSごとにたくさんのSSH鍵があって管理が大変だったのでこれに一元化することで管理を楽に出来ないかと思ったのだが、これは出来ないのかもしれない。

昔やった記憶があるので簡単に終わらせるつもりだったが泥沼にハマってしまった。

まずセキュリティキーのSSH鍵を使用するにはOpenSSHのバージョン8.2以上が必要なのだがWindowsに標準？で付属しているOpenSSHは`OpenSSH_for_Windows_7.7p1, LibreSSL 2.6.5`なので対応していない。そこでgit for windowsに付属するOpenSSHを使用した。これはバージョンが`OpenSSH_8.5p1, OpenSSL 1.1.1k`なので使えると思った。

実際に`$ ssh-keygen -t ed25519-sk`を実行してみると`Key enrollment failed: invalid format`というエラーが出て鍵が作成できない。

紹介ページをよく見るとWindowsではCygwinを使えと書いてあったのでCygwinを入れてみた。なにかパッケージマネージャがあるのかと思いきやセットアップウィザードにパッケージの一覧が出てくるのでsshなどを頑張って探してバージョンを選択する必要が有るようだった。どうして…

戸惑いつつCygwinを入れたが結局git for windowsのOpenSSHを使用したときと同じエラーが出てしまった。

Linuxでも試したところ同じエラーが出たのだが権限設定が正しくなくてアクセス出来ていなかったのと、libfido2が入ってなかったのがダメだったらしい。residentというオプションを付けるとあとから秘密鍵が取り出せる(PINは要求されるがほんとに？)らしくどうなるのか試してみようと思ったのだが、これはまたinvalid formatと言われて失敗した。何か大量のデバッグメッセージを吐かせて検索しようと思う。

権限はWindowsではよくわからないがCygwinはもしかするとlibfido2があれば動くのかもしれない。

そもそもLinuxではPGP鍵をSSH鍵として使えるので別になくても困らないし、WindowsでPGPを上手く使うのが難しいのでやり始めたのに結局動かないんじゃ意味がない。

GPGでなぜgpg-agentのssh-agent機能がうまく動かないのかわからない。ソケットファイルの仕様がなにか違うのだとは思うが…

また明日リベンジする。

## あとがき

久々に中身が濃いめだがパソコンオタクっぽい日記になった。

ところでこんな日記でも毎日10人弱(自分で複数アクセスしてることもあるのでもう少し少ない？)の人が見ているのは完全に想定外だけど嬉しいものですね。

感情に対して「少し」、「ちょっと」といった小さいかのような表現をよく使ってしまうのでもっとクソデカ感情をぶつけていきたいですね(4箇所くらい直した)。

今日の日記はメインPCで書きました。

変更履歴:  
05/12/2021 01:04:46: 20210511追加  
